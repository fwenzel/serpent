var requirejs,require,define;(function(a){function g(a,b){if(a&&a.charAt(0)==="."&&b){b=b.split("/"),b=b.slice(0,b.length-1),a=b.concat(a.split("/"));var c,d;for(c=0;d=a[c];c++)if(d===".")a.splice(c,1),c-=1;else if(d===".."){if(c===1&&(a[2]===".."||a[0]===".."))break;c>0&&(a.splice(c-1,2),c-=2)}a=a.join("/")}return a}function h(b,c){return function(){return f.apply(a,d.call(arguments,0).concat([b,c]))}}function i(a){return function(b){return g(b,a)}}function j(a){return function(c){b[a]=c}}function k(d){if(c.hasOwnProperty(d)){var f=c[d];delete c[d],e.apply(a,f)}return b[d]}function l(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=g(a.slice(0,e),b),a=a.slice(e+1),d=k(c),d&&d.normalize?a=d.normalize(a,i(b)):a=g(a,b)):a=g(a,b),{f:c?c+"!"+a:a,n:a,p:d}}var b={},c={},d=[].slice,e,f;if(typeof define=="function")return;e=function(d,e,f,g){var i=[],m,n,o,p,q,r;g||(g=d);if(typeof f=="function"){!e.length&&f.length&&(e=["require","exports","module"]);for(p=0;p<e.length;p++){r=l(e[p],g),o=r.f;if(o==="require")i[p]=h(d);else if(o==="exports")i[p]=b[d]={},m=!0;else if(o==="module")n=i[p]={id:d,uri:"",exports:b[d]};else if(b.hasOwnProperty(o)||c.hasOwnProperty(o))i[p]=k(o);else{if(!r.p)throw d+" missing "+o;r.p.load(r.n,h(g,!0),j(o),{}),i[p]=b[o]}}q=f.apply(b[d],i),d&&(n&&n.exports!==a?b[d]=n.exports:m||(b[d]=q))}else d&&(b[d]=f)},requirejs=f=function(b,c,d,g){return typeof b=="string"?k(l(b,c).f):(b.splice||(c.splice?(b=c,c=arguments[2]):b=[]),g?e(a,b,c,d):setTimeout(function(){e(a,b,c,d)},15),f)},f.config=function(){return f},require||(require=f),define=function(a,b,d){b.splice||(d=b,b=[]),define.unordered?c[a]=[a,b,d]:e(a,b,d)},define.amd={jQuery:!0}})(),define("almond",function(){}),define("assets",[],function(){var a=[{src:"img/level1.png",points:15},{src:"img/level2.png",start:{x:4,y:15},dir:3,points:25},{src:"img/level3.png",points:35},{src:"img/level4.png",start:{x:20,y:20},dir:1}],b={food:{src:"img/apple.png"},snake:{src:"img/snake.png"}},c=document.createElement("canvas"),d=c.getContext("2d");for(var e in a){var f=new Image;f.onload=function(a,b){return function(){c.width=a.width,c.height=a.height,d.drawImage(a,0,0);var e=d.getImageData(0,0,c.width,c.height).data,f=[];for(var g=0;g<e.length/4;g++){var h=e[g*4]===0&&e[g*4+1]===0&&e[g*4+2]===0;if(h){var i=g%c.width,j=Math.floor(g/c.width);f.push({x:i,y:j})}b.walls=f}b.loaded=!0}}(f,a[e]),f.src=a[e].src}for(var e in b){var f=new Image;f.onload=function(a){return function(){a.loaded=!0}}(b[e]),f.src=b[e].src,b[e].img=f}return{levels:a,images:b}}),define("utils",{getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a}}),require.config({baseUrl:"js/lib"}),require(["assets","utils"],function(a,b){function l(){this.speed=5,this.length=8,this.dir=h.dir||2,this.path=[h.start||{x:g.width/2,y:g.height/2}],this.lives=m===undefined||!m?3:m.lives,this.since_last_update=0,this.dirchange=!1}function n(){this.ttl=60,this.val=5;do this.x=b.getRandomInt(0,g.width-1),this.y=b.getRandomInt(0,g.height-1);while(p(this))}function p(a){var b=[m.path,h.walls];for(var c in b){var d=b[c];for(var e in d)if(a.x===d[e].x&&a.y===d[e].y)return!0}return!1}function q(a){if(a.keyCode===80){v();return}if(g.paused||m.dirchange)return;if(!(a.keyCode in k))return;a.preventDefault();var b={1:3,2:4,3:1,4:2};if(k[a.keyCode]===b[m.dir])return;m.dirchange=!0,m.dir=k[a.keyCode]}function r(a){if(g.paused||m.dirchange)return;a.preventDefault(),m.dirchange=!0;if([1,3].indexOf(m.dir)!==-1){var b=a.pageX-a.target.offsetLeft;b>i.offsetWidth/2?m.dir=2:m.dir=4}else{var c=a.pageY-a.target.offsetTop;c>i.offsetHeight/2?m.dir=3:m.dir=1}}function s(){h=a.levels[g.levelidx],m=new l,o=[]}function t(a){m.since_last_update+=a;if(m.since_last_update<1e3/m.speed)return;m.since_last_update-=1e3/m.speed;for(var b in o)o[b].ttl-=1;o=o.filter(function(a){return a.ttl>0}),o.length<3&&Math.random()<.08/(o.length+1)&&o.push(new n);var c=m.path[m.path.length-1],d={x:c.x,y:c.y};switch(m.dir){case 1:d.y-=1;break;case 2:d.x+=1;break;case 3:d.y+=1;break;case 4:d.x-=1}d.x=(d.x+g.width)%g.width,d.y=(d.y+g.height)%g.height;if(p(d)){m.lives-=1,m.lives===0&&(g.levelidx=0,m=null),s();return}for(var b in o)if(o[b].x===d.x&&o[b].y===d.y){m.length+=o[b].val;if("points"in h&&m.length>=h.points){g.levelidx+=1,s();return}o.splice(b,1);break}m.path.push(d),m.path.length>m.length&&m.path.shift(),m.dirchange=!1}function u(){j.clearRect(0,0,i.width,i.height);if("loaded"in h){j.fillStyle="#777";for(var b in h.walls)j.fillRect(h.walls[b].x*f,h.walls[b].y*f,f,f)}if("loaded"in a.images.snake){j.globalAlpha=.5;for(var b=0;b<m.lives;b++)j.drawImage(a.images.snake.img,i.width-f-(b+1)*1.2*a.images.snake.img.width,i.height-a.images.snake.img.height-f-5);j.globalAlpha=1}for(var b in o)o[b].render();j.fillStyle="rgb(200, 0, 0)";for(var b in m.path)j.fillRect(m.path[b].x*f,m.path[b].y*f,f,f);j.fillStyle="rgb(0, 0, 0)",j.font="14pt SilkscreenNormal, Arial, sans-serif",j.textAlign="right",j.textBaseline="bottom",j.fillText("Level: "+(g.levelidx+1),i.width-f,i.height+1),g.paused&&(j.fillStyle="rgb(0, 0, 0)",j.font="36pt SilkscreenNormal, Arial, sans-serif",j.textAlign="center",j.textBaseline="middle",j.fillText("PAUSE",i.width/2,i.height/2))}function v(a){e||a?(g.paused=!0,e=null):(g.paused=!1,x=Date.now(),e=d(w))}function w(){var a=Date.now(),b=a-x;t(b),u(),x=a,g.paused||(e=d(w))}var c=window.document,d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1e3/60),1},e,f=16,g={width:32,height:32,paused:!1,levelidx:0},h,i=c.createElement("canvas"),j=i.getContext("2d");i.width=g.width*f,i.height=g.height*f,i.id="game-canvas",c.getElementById("game").appendChild(i);var k={38:1,39:2,40:3,37:4},m;n.prototype.render=function(){if(!("loaded"in a.images.food))return;j.drawImage(a.images.food.img,this.x*f,this.y*f)};var o=[];window.addEventListener("blur",function(){v(!0)}),window.addEventListener("keydown",q,!1),i.addEventListener("touchStart",r,!1),i.addEventListener("click",r,!1),s();var x=Date.now();w()}),define("app",function(){})